from zhipuai import ZhipuAI
import config


api_key = config.config['api_key']


class ZhipuAIReply:
    def __init__(self, text):
        self.text = text
        self.client = ZhipuAI(api_key=api_key)
        self.reply = None

    def GetReply(self, prompt=None):
        content = "ä½œä¸ºä¸€åç½‘ç»œèˆ†è®ºå›å¤ä¸“å®¶ï¼Œè¯·ä¸ºæ¥ä¸‹æ¥æä¾›çš„å¸–å­ç”Ÿæˆä¸€æ®µè¯„è®ºï¼Œè¦èƒ½å¤Ÿå®‰æŠšäººå¿ƒï¼Œå®ç°å¹³æ¯èˆ†è®ºçš„ç›®çš„ï¼Œå­—æ•°è¦é™åˆ¶åœ¨100å­—ä»¥å†…ï¼Œå¹¶ä¸”è¨€ç®€æ„èµ…"
        if prompt is not None:
            content = prompt
        response = self.client.chat.completions.create(
            model="glm-4",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹åç§°
            messages=[
                {"role": "user", "content": content},
                {"role": "assistant", "content": "å½“ç„¶å¯ä»¥ã€‚è¯·æ‚¨æä¾›é‚£æ®µæ¶æ„è¨€è®ºï¼Œæˆ‘ä¼šæ ¹æ®å†…å®¹ç”Ÿæˆä¸€æ®µæ—¨åœ¨å®‰æŠšäººå¿ƒã€å¹³æ¯èˆ†è®ºçš„å›å¤ã€‚"},
                {"role": "user", "content": 'ä¸è¦æåˆ°è‡ªå·±çš„èº«ä»½ï¼Œåªéœ€è¦ç”Ÿæˆå›å¤å³å¯ã€‚å›å¤è¦ä»æ™®é€šç½‘æ°‘è§†è§’å‡ºå‘ï¼Œä»¥ç½‘å‹çš„å£å»å›å¤,é£æ ¼è¦æ¥è¿‘ä¸€èˆ¬ç½‘ç»œè¯„è®º'},
                {"role": "assistant", "content": "å¥½çš„ï¼Œæˆ‘ä¸ä¼šæåˆ°è‡ªå·±çš„èº«ä»½ã€‚æˆ‘ä¼šä»æ™®é€šç½‘æ°‘è§’åº¦å‡ºå‘ï¼Œä»¥ç½‘å‹çš„è¯­æ°”ç”Ÿæˆå›å¤ã€‚"},
                {"role": "user", "content": 'å¥é¦–å’Œå¥å°¾ä¸è¦ä½¿ç”¨å¼•å·ã€‚'},
                {"role": "user", "content": self.text},
            ],
            # stream=True,
        )
        self.reply = response.choices[0].message
        return response.choices[0].message


if __name__ == '__main__':
    text = '#è°­ç«¹ ä¸€åªå°å¸ƒ#ä¸€åªå°å¸ƒä¸ºè°­ç«¹èƒ–çŒ«äº‹ä»¶æ­å‘äº†æ›´å¤šçœŸç›¸ï¼ŒåŸæ¥è°­ç«¹ä¸ä»…å‘å®³èƒ–çŒ«ï¼ŒåŒæ—¶ä¹Ÿåœ¨å¯¹å¥³ç”Ÿä¸‹æ‰‹ï¼Œå‘å±•Puaå¯¹è±¡æ•›è´¢ã€‚è¿™è®©äººæƒ³åˆ°è¯±éª—è€æ‰‹éƒ½ç¾ç«¹ï¼Œä¹Ÿæ˜¯åœ¨ç½‘ç»œä¸Šå¯¹å•äº²å¦ˆå¦ˆéª—ğŸ’°ï¼Œå·ç§°æŠ¥è­¦ä¹Ÿä¸æ€•ã€‚è°­ç«¹ã€éƒ½ç¾ç«¹ç­‰æå¥³å¦‚æ­¤æ¶åŠ£ï¼Œå´æ‰“ç€å¥³æ€§çš„æ——å·æ•›è´¢ï¼Œæ˜¯å¦‡å¥³æƒç›Šè¿›æ­¥æœ€å¤§çš„ç»Šè„šçŸ³ï¼Œç®€ç›´ç»™å…¢å…¢ä¸šä¸šè®¤çœŸå·¥ä½œçš„å¥³æ€§ç¾¤ä½“è’™ç¾ï¼Œå¸Œæœ›è¿™ä¸¤äººå¾—åˆ°æ³•å¾‹çš„ä¸¥æƒ©ã€‚ '
    test = ZhipuAIReply(text=text)
    reply = test.GetReply()
    print(test.reply.content)
    """
    CompletionMessage(content='å“ï¼Œçœ‹åˆ°è¿™æ ·çš„æ¶ˆæ¯çœŸæ˜¯è®©äººå¿ƒæƒ…æ²‰é‡ã€‚æˆ‘è§‰å¾—å§ï¼Œä¸ç®¡äº‹æƒ…çœŸç›¸å¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½ä¸èƒ½å› ä¸ºä¸ªåˆ«äººçš„è¡Œä¸ºå°±å¦å®šäº†ä¸€ä¸ªç¾¤ä½“ã€‚ç½‘ç»œä¸Šæ€»æ˜¯ä¼šæœ‰ä¸€äº›è´Ÿé¢æ–°é—»ï¼Œä½†å’±ä»¬ä¸èƒ½è®©è¿™äº›æç«¯æ¡ˆä¾‹å½±å“äº†æˆ‘ä»¬å¯¹å¤§å¤šæ•°äººçš„åˆ¤æ–­ã€‚æ³•å¾‹æ˜¯å…¬æ­£çš„ï¼Œå¦‚æœçœŸçš„æœ‰äººåšäº†è¿æ³•çš„äº‹ï¼Œè‡ªç„¶ä¼šæœ‰æ³•å¾‹æ¥ä¸¥æƒ©ã€‚æˆ‘ä»¬ä½œä¸ºç½‘æ°‘ï¼Œè¿˜æ˜¯åº”è¯¥ä¿æŒå†·é™ï¼Œä¸è¦è¢«æƒ…ç»ªå¸¦äº†èŠ‚å¥ã€‚\n\nè‡³äºé‚£äº›çœŸæ­£åœ¨åŠªåŠ›å·¥ä½œã€è®¤çœŸç”Ÿæ´»çš„å¥³æ€§ï¼Œå¥¹ä»¬æ‰æ˜¯æˆ‘ä»¬åº”è¯¥å…³æ³¨çš„ç„¦ç‚¹ã€‚å’±ä»¬ä¸èƒ½å› ä¸ºå°‘æ•°äººçš„è¡Œä¸ºï¼Œå°±ç»™æ•´ä¸ªç¾¤ä½“è´´ä¸Šæ ‡ç­¾ã€‚è®©æˆ‘ä»¬ä¸€èµ·æœŸå¾…æ­£ä¹‰çš„åˆ°æ¥ï¼ŒåŒæ—¶ä¹Ÿè¦ä¼ æ’­æ­£èƒ½é‡ï¼Œæ”¯æŒé‚£äº›çœŸæ­£å€¼å¾—å°Šæ•¬çš„äººä»¬ã€‚åˆ«è®©ä¸€æ—¶çš„æ„¤æ€’å’Œåè§ï¼Œé®ä½äº†æˆ‘ä»¬çœ‹å¾…è¿™ä¸ªä¸–ç•Œçš„çœ¼ç›ã€‚åŠ æ²¹ï¼Œå°ä¼™ä¼´ä»¬ï¼ğŸŒŸ', role='assistant', tool_calls=None)
    """
"""
åŒæ­¥è°ƒç”¨ç¤ºä¾‹ï¼Œè°ƒç”¨åå³å¯ä¸€æ¬¡æ€§è·å¾—æœ€ç»ˆç»“æœ
from zhipuai import ZhipuAI
client = ZhipuAI(api_key="") # å¡«å†™æ‚¨è‡ªå·±çš„APIKey
response = client.chat.completions.create(
    model="glm-4",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹åç§°
    messages=[
        {"role": "user", "content": "ä½œä¸ºä¸€åè¥é”€ä¸“å®¶ï¼Œè¯·ä¸ºæˆ‘çš„äº§å“åˆ›ä½œä¸€ä¸ªå¸å¼•äººçš„slogan"},
        {"role": "assistant", "content": "å½“ç„¶ï¼Œä¸ºäº†åˆ›ä½œä¸€ä¸ªå¸å¼•äººçš„sloganï¼Œè¯·å‘Šè¯‰æˆ‘ä¸€äº›å…³äºæ‚¨äº§å“çš„ä¿¡æ¯"},
        {"role": "user", "content": "æ™ºè°±AIå¼€æ”¾å¹³å°"},
        {"role": "assistant", "content": "æ™ºå¯æœªæ¥ï¼Œè°±ç»˜æ— é™ä¸€æ™ºè°±AIï¼Œè®©åˆ›æ–°è§¦æ‰‹å¯åŠ!"},
        {"role": "user", "content": "åˆ›é€ ä¸€ä¸ªæ›´ç²¾å‡†ã€å¸å¼•äººçš„slogan"}
    ],
)
print(response.choices[0].message)
"""

"""
å¼‚æ­¥è°ƒç”¨ç¤ºä¾‹ï¼Œè°ƒç”¨åä¼šç«‹å³è¿”å›ä¸€ä¸ªä»»åŠ¡ ID ï¼Œç„¶åç”¨ä»»åŠ¡IDæŸ¥è¯¢è°ƒç”¨ç»“æœï¼ˆæ ¹æ®æ¨¡å‹å’Œå‚æ•°çš„ä¸åŒï¼Œé€šå¸¸éœ€è¦ç­‰å¾…10-30ç§’æ‰èƒ½å¾—åˆ°æœ€ç»ˆç»“æœï¼‰
from zhipuai import ZhipuAI

client = ZhipuAI(api_key="") # è¯·å¡«å†™æ‚¨è‡ªå·±çš„APIKey
response = client.chat.asyncCompletions.create(
    model="glm-4",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹åç§°
    messages=[
        {
            "role": "user",
            "content": "è¯·ä½ ä½œä¸ºç«¥è¯æ•…äº‹å¤§ç‹ï¼Œå†™ä¸€ç¯‡çŸ­ç¯‡ç«¥è¯æ•…äº‹ï¼Œæ•…äº‹çš„ä¸»é¢˜æ˜¯è¦æ°¸è¿œä¿æŒä¸€é¢—å–„è‰¯çš„å¿ƒï¼Œè¦èƒ½å¤Ÿæ¿€å‘å„¿ç«¥çš„å­¦ä¹ å…´è¶£å’Œæƒ³è±¡åŠ›ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿå¸®åŠ©å„¿ç«¥æ›´å¥½åœ°ç†è§£å’Œæ¥å—æ•…äº‹ä¸­æ‰€è•´å«çš„é“ç†å’Œä»·å€¼è§‚ã€‚"
        }
    ],
)
print(response)
"""

"""
SSEè°ƒç”¨ç¤ºä¾‹ï¼Œè°ƒç”¨åå¯ä»¥æµå¼çš„å®æ—¶è·å–åˆ°ç»“æœç›´åˆ°ç»“æŸ
from zhipuai import ZhipuAI
client = ZhipuAI(api_key="") # è¯·å¡«å†™æ‚¨è‡ªå·±çš„APIKey
response = client.chat.completions.create(
    model="glm-4",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹åç§°
    messages=[
        {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªä¹äºè§£ç­”å„ç§é—®é¢˜çš„åŠ©æ‰‹ï¼Œä½ çš„ä»»åŠ¡æ˜¯ä¸ºç”¨æˆ·æä¾›ä¸“ä¸šã€å‡†ç¡®ã€æœ‰è§åœ°çš„å»ºè®®ã€‚"},
        {"role": "user", "content": "æˆ‘å¯¹å¤ªé˜³ç³»çš„è¡Œæ˜Ÿéå¸¸æ„Ÿå…´è¶£ï¼Œç‰¹åˆ«æ˜¯åœŸæ˜Ÿã€‚è¯·æä¾›å…³äºåœŸæ˜Ÿçš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶å¤§å°ã€ç»„æˆã€ç¯ç³»ç»Ÿå’Œä»»ä½•ç‹¬ç‰¹çš„å¤©æ–‡ç°è±¡ã€‚"},
    ],
    stream=True,
)
for chunk in response:
    print(chunk.choices[0].delta)
"""
